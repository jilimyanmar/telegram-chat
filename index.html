<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Telegram Admin</title>

<style>
body{margin:0;font-family:Arial;background:#dfe7ec}
.app{display:flex;height:100vh}

/* LEFT */
.sidebar{
  width:32%;
  background:#fff;
  border-right:1px solid #ccc;
  overflow-y:auto;
}
.user{
  padding:12px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.user.active{background:#0088cc;color:white}
.name{font-weight:bold}
.preview{
  font-size:13px;
  color:#666;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.badge{
  background:red;
  color:white;
  border-radius:12px;
  padding:2px 7px;
  font-size:12px;
  float:right;
}

/* CHAT */
.chat-area{width:68%;display:flex;flex-direction:column;background:#e5ddd5}
.header{background:#0088cc;color:white;padding:12px}
.messages{flex:1;padding:15px;overflow-y:auto}
.bubble{
  max-width:65%;
  padding:10px;
  margin-bottom:8px;
  border-radius:10px;
}
.user-msg{background:white}
.admin-msg{background:#dcf8c6;margin-left:auto}
.time{font-size:11px;color:#666;margin-top:4px}

/* INPUT */
.input{
  padding:10px;
  background:#f0f0f0;
}
.input input{
  width:100%;
  padding:10px;
  margin-bottom:5px;
}
</style>
</head>

<body>

<div class="app">

  <div class="sidebar" id="users"></div>

  <div class="chat-area">
    <div class="header" id="header">Select chat</div>
    <div class="messages" id="chat"></div>
    <div class="input">
      <input id="text" placeholder="Message">
      <input id="image" placeholder="Image URL (optional)">
      <button onclick="send()">Send</button>
    </div>
  </div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxSkmLEdi-aYAZWo8JsEQMxQ-DK5__1fcdeE80HsIVz3mmulYZ6UgYdt2InXsTLZkwsLg/exec";
let chats={}, current=null;

function load(){
 fetch(API).then(r=>r.json()).then(d=>{
  chats=d;
  renderUsers();
 });
}

function renderUsers(){
 let h="";
 for(let id in chats){
  const last=chats[id].messages.slice(-1)[0];
  h+=`
   <div class="user ${id===current?'active':''}" onclick="openChat('${id}')">
    <span class="name">${chats[id].name}</span>
    ${chats[id].unread?`<span class="badge">${chats[id].unread}</span>`:""}
    <div class="preview">${last?.text || (last?.photo?"ðŸ“· Photo":"")}</div>
   </div>`;
 }
 users.innerHTML=h;
}

function openChat(id){
 current=id;
 header.innerText=chats[id].name;
 chats[id].unread=0;
 renderUsers();

 let h="";
 chats[id].messages.forEach(m=>{
  h+=`
   <div class="bubble ${m.from==='admin'?'admin-msg':'user-msg'}">
    ${m.text||""}
    ${m.photo?`<br><img src="https://api.telegram.org/file/bot<TOKEN>/${m.photo}" width="200">`:""}
    ${m.image?`<br><img src="${m.image}" width="200">`:""}
    <div class="time">${m.time}</div>
   </div>`;
 });
 chat.innerHTML=h;
 chat.scrollTop=chat.scrollHeight;
}

function send(){
 if(!current) return alert("Select user");
 fetch(API+`?send=1&chatId=${current}&text=${encodeURIComponent(text.value)}&image=${encodeURIComponent(image.value)}`)
  .then(()=>{
    text.value="";image.value="";
    load();openChat(current);
  });
}

load();
setInterval(load,5000);
</script>

</body>
</html>
