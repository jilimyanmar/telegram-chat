<div style="display:flex;height:500px">

  <div id="users" style="width:30%;border-right:1px solid #ccc;overflow:auto"></div>

  <div style="width:70%;padding:10px">
    <div id="chat" style="height:400px;overflow:auto"></div>
    <input id="text" placeholder="Type reply">
    <button onclick="send()">Send</button>
  </div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxSkmLEdi-aYAZWo8JsEQMxQ-DK5__1fcdeE80HsIVz3mmulYZ6UgYdt2InXsTLZkwsLg/exec";
let currentUser = null;
let chats = {};

function load(){
 fetch(API).then(r=>r.json()).then(d=>{
  chats = d;
  renderUsers();
 });
}

function renderUsers(){
 let h="";
 for(let id in chats){
  h+=`<div onclick="openChat('${id}')" style="padding:8px;border-bottom:1px solid #eee;cursor:pointer">
       ${chats[id].name}
      </div>`;
 }
 users.innerHTML=h;
}

function openChat(id){
 currentUser=id;
 let m=chats[id].messages;
 let h="";
 m.forEach(x=>{
  h+=`<div style="margin:5px;text-align:${x.from=='admin'?'right':'left'}">
       ${x.text}<br><small>${x.time}</small>
      </div>`;
 });
 chat.innerHTML=h;
 chat.scrollTop=chat.scrollHeight;
}

function send(){
 if(!currentUser) return alert("Select user");
 let t=text.value.trim();
 if(!t) return;
 fetch(API+`?send=1&chatId=${currentUser}&text=`+encodeURIComponent(t))
  .then(()=>{ text.value=""; load(); });
}

load();
setInterval(load,5000);
</script>
